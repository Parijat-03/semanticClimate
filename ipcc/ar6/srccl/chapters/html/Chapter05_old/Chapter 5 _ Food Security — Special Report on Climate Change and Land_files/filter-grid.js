var site_url='//'+window.location.host+'/';var scripts=document.querySelectorAll('script[src]'),src=scripts[scripts.length-1].src,filename=src.split('/').pop();var theme_dir=src.replace('/resources/js/'+filename,'');var gridtab_defaults={grid:4,borderWidth:0,tabPadding:0,contentPadding:0,contentBackground:'#eef4fa',activeTabBackground:'transparent',config:{layout:'tab',scrollToTab:true,showClose:true},responsive:[{breakpoint:800,settings:{grid:3}},{breakpoint:600,settings:{grid:2}}]};(function($){function filter_grid(item,options){this.item=$(item);var defaults={hash:{},elements:{container:'#grid-container',thing:null,filter_trigger:'.filter-trigger',filter_item:'.grid-filter-item',view_item:'.grid-view-item',grid:'#grid-items',grid_item:'.grid-item-link',},gridtab:{options:{}},view:'grid',filter:{},logging:true};this.options=$.extend(true,defaults,options);this.options.gridtab.defaults=Object.assign({},gridtab_defaults);this.init();}
filter_grid.prototype={init:function(){var plugin_instance=this;var plugin_item=plugin_instance.item;var plugin_settings=plugin_instance.options;var plugin_elements=plugin_settings.elements;if(plugin_settings.logging==true){console.log('filter grid init');console.log(plugin_settings);}
$('<div id="filter-grid-spinner"></div>').appendTo('body');if(window.location.hash){var location_hash=window.location.hash.substring(1).split(',');for(i=0;i<location_hash.length;i+=1){var hash_key=location_hash[i].split('_')[0];var hash_val=location_hash[i].split('_')[1];plugin_settings.hash[hash_key]=hash_val;plugin_item.addClass('filter-open');plugin_item.find('[data-value="'+hash_val+'"]').addClass('selected');plugin_instance._evaluate();}}
var media_atts=JSON.parse($(plugin_elements.container).attr('data-settings'));plugin_settings.gridtab.options=$.extend(plugin_settings.gridtab.defaults,media_atts.gridtab);if(media_atts.display.scroll==false){plugin_settings.gridtab.options.config.scrollToTab=false;}
plugin_settings.gridtab.options.grid=parseInt(media_atts['display']['columns']);console.log(plugin_settings.gridtab.options);$(plugin_elements.grid).gridtab(plugin_settings.gridtab.options);plugin_item.find(plugin_elements.view_item).click(function(){var item_setting=$(this).parents('ul').attr('data-setting'),item_val=$(this).attr('data-value');$(this).siblings('li').removeClass('selected');$(this).addClass('selected');if(item_val=='list'){plugin_settings['gridtab']['options']['grid']=1;}else{plugin_settings['gridtab']['options']['grid']=gridtab_defaults['grid'];}
plugin_settings['view']=item_val;plugin_instance._load_items();});plugin_item.find(plugin_elements.filter_item).click(function(){if(!$(this).hasClass('selected')){$(this).siblings('li').removeClass('selected');$(this).addClass('selected');}else{if($(this).closest('ul').hasClass('allow-null')){$(this).removeClass('selected');}}
plugin_instance._evaluate();});plugin_item.find(plugin_elements.filter_trigger).click(function(){if(plugin_item.hasClass('filter-open')){plugin_item.removeClass('filter-open');}else{plugin_item.addClass('filter-open');}});$(plugin_elements.grid_item).click(function(e){e.preventDefault();});$('#grid-items dt').click(function(e){plugin_instance._graphic_click({clicked:$(this)});});},_evaluate:function(fn_options){var plugin_instance=this;var plugin_item=this.item;var plugin_settings=plugin_instance.options;var plugin_elements=plugin_settings.elements;var defaults={clicked:null};var settings=$.extend(true,defaults,fn_options);plugin_settings.hash={};if(plugin_settings.logging==true){console.log('evaluating');}
var new_hash='',hash_count=0;$(plugin_elements.filter_item+'.selected').each(function(){var item_setting=$(this).parents('ul').attr('data-setting'),item_key=$(this).parents('ul').attr('data-key');item_val=$(this).attr('data-value');plugin_settings.hash[item_key]=item_val;});if(!$.isEmptyObject(plugin_settings.hash)){if(plugin_settings.logging==true){console.log('hash exists');}
new_hash='#';for(var key in plugin_settings.hash){if(hash_count!=0){new_hash+=',';}
new_hash+=key+'_'+plugin_settings.hash[key];hash_count+=1;}}
console.log(new_hash);history.pushState(null,document.title,window.location.origin+window.location.pathname+new_hash);plugin_instance._load_items({});},_load_items:function(fn_options){var plugin_instance=this;var plugin_item=this.item;var plugin_settings=plugin_instance.options;var plugin_elements=plugin_settings.elements;var defaults={clicked:null};var settings=$.extend(true,defaults,fn_options);$('#filter-grid-spinner').fadeIn();console.log(plugin_settings);plugin_item.find(plugin_elements.grid).slideUp(250,function(){$(this).remove();$.ajax({url:window.location.href,data:plugin_settings,success:function(data){var new_html=$(data).find(plugin_elements.grid).appendTo(plugin_elements.container);console.log(new_html);new_html.gridtab(plugin_settings.gridtab.options);new_html.find(plugin_elements.grid_item).click(function(e){e.preventDefault();});new_html.find('dt').click(function(e){plugin_instance._graphic_click({clicked:$(this)});});}});});$('#filter-grid-spinner').fadeOut();},_graphic_click:function(fn_options){var plugin_instance=this;var plugin_item=this.item;var plugin_settings=plugin_instance.options;var plugin_elements=plugin_settings.elements;var defaults={clicked:null};var settings=$.extend(true,defaults,fn_options);var link_href=settings.clicked.find(plugin_elements.grid_item).attr('href'),tab=settings.clicked,new_html,tweet_text;var expand_container=tab.next('dd');if(expand_container.find('.expand-content').length){if(!tab.hasClass('loaded')){$('#filter-grid-spinner').fadeIn();var expand_content=expand_container.find('.expand-content');$.ajax({url:link_href,success:function(data){expand_content.fadeOut(250,function(){expand_content.empty();new_html=$(data).filter('.attachment-wrap').appendTo(expand_content);tweet_text=new_html.find('.figcaption h4').text()+' â€” '+document.title+': ';$(expand_content).fadeIn(250);});tab.addClass('loaded');},complete:function(){console.log('complete');setTimeout(function(){console.log(expand_content.find('.attachment-dl-type'));expand_content.find('.attachment-dl-type').togglebox({off:'SD',on:'HD',debug:false});expand_content.find('.attachment-dl-type').change(function(){console.log('changed');var dl_href=$(this).attr('data-val-off');if($(this).prop('checked')){dl_href=$(this).attr('data-val-on');}
$(this).parents('.attachment-meta').find('.attachment-dl-link').attr('href',dl_href);});new_html.find('.share').each(function(){$(this).share_widget({share_url:link_href,elements:{facebook:{display:true,icon:'icon-social-facebook'},twitter:{display:true,text:tweet_text,icon:'icon-social-twitter'}}});});function attachment_stick(){if($(window).width()>800){new_html.find('.figure-image-sticky').stick_in_parent({parent:'figure',offset_top:120});}else{new_html.find('.figure-image-sticky').trigger('sticky_kit:detach');}}
attachment_stick();$(window).resize(function(){attachment_stick();});$('#filter-grid-spinner').fadeOut();},1000);}});}}}}
$.fn.filter_grid=function(opt){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){var item=$(this);var instance=item.data('filter_grid');if(!instance){item.data('filter_grid',new filter_grid(this,opt));}else{if(typeof opt==='string'){instance[opt].apply(instance,args);}}});}}(jQuery));